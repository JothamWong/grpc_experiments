import argparse

if __name__ == "__main__":
    argparser = argparse.ArgumentParser("Generate proto benchmark")
    argparser.add_argument("-n", "--n_messages", type=int, help="Num message types")
    args = argparser.parse_args()
    n_messages = args.n_messages
    program = ['''// This file is automatically generated. Do not modify.
syntax="proto3";
import "google/protobuf/empty.proto";
package protobenchmark;
    ''']
    for m in range(1, n_messages+1):
        program.append(f"message M{m} {{")
        for n in range(1, m+1):
            program.append(f"  int32 arg{n} = {n};")
        program.append("}")
    
    program.append("service Messages {")
    program.append("rpc GetM0(google.protobuf.Empty) returns (google.protobuf.Empty);")
    for m in range(1, n_messages+1):
        program.append(f"rpc GetM{m}(M{m}) returns (M{m});")
    program.append("}")
    program_string = "\n".join(program)
    with open("myproto/message.proto", "w") as outf:
        outf.write(program_string)